<script>
  import { Link } from "svelte-routing";
  import { firebaseConfig } from "../Store/firebaseConfig";
  import { initializeApp } from "firebase/app";
  import {
    getFirestore,
    collection,
    onSnapshot,
    doc,
    updateDoc,
    deleteDoc,
  } from "firebase/firestore";
  import { getAuth } from "firebase/auth";

  const firebaseApp = initializeApp(firebaseConfig);

  const db = getFirestore();
  const auth = getAuth();

  let colRef;
  let tasks = [];
  let unsubscribe;
  let isLoggedIn;

  auth.onAuthStateChanged((user) => {
    if (user) {
      isLoggedIn = true
      colRef = collection(db, "tasks");
      unsubscribe = onSnapshot(colRef, (querySnapshot) => {
        let storedTasks = [];
        querySnapshot.forEach((doc) => {
          let task = { ...doc.data(), id: doc.id };
          storedTasks = [task, ...storedTasks];
        });
        console.table(storedTasks);
        tasks = storedTasks;
      });
    } else {
      isLoggedIn = false;
      unsubscribe && unsubscribe();
      console.log("The user logged out");
    }
  });

  const taskCompleted = async (task) => {
    await updateDoc(doc(db, "tasks", task.id), {
      isComplete: !task.isComplete,
    });
  };

  const handleDelete = async (id) => {
    await deleteDoc(doc(db, "tasks", id));
  };
</script>

<main>
  {#each tasks as task}
    <h2>Tasks</h2>
    <div class="task">
      <section class="section1">
        <div class="left-sec">
          <input type="checkbox" on:click={() => taskCompleted(task)} />
          <h4>{task.title}</h4>
        </div>
        {#if task.description.length > 0}
          <div class="below-sec">
            <p>{task.description}</p>
          </div>
        {/if}
      </section>
      <section>
        <svg
          width="30"
          height="30"
          viewBox="0 0 30 30"
          fill="none"
          on:click={() => handleDelete(task.id)}
        >
          <rect
            x="6"
            y="8.5"
            width="18"
            height="17"
            rx="1"
            stroke="#004221"
            stroke-width="2"
            stroke-linejoin="round"
          />
          <path
            d="M6 4.5C5.44772 4.5 5 4.94772 5 5.5C5 6.05228 5.44772 6.5 6 6.5V4.5ZM24 6.5C24.5523 6.5 25 6.05228 25 5.5C25 4.94772 24.5523 4.5 24 4.5V6.5ZM16 4V3H14V4H16ZM6 6.5H15V4.5H6V6.5ZM15 6.5H24V4.5H15V6.5ZM14 4V5.5H16V4H14Z"
            fill="#004221"
          />
          <path d="M15 12.5V20.5" stroke="#004221" stroke-width="2" />
          <path d="M10 12.5V20.5" stroke="#004221" stroke-width="2" />
          <path d="M20 12.5V20.5" stroke="#004221" stroke-width="2" />
        </svg>
      </section>
    </div>
  {:else}
  {#if isLoggedIn == false}
  <svg class="logIn" viewBox="0 0 870 521" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_101_45)">
    <path d="M666.092 514.257C654.954 504.845 648.189 489.977 649.963 475.503C651.737 461.029 662.726 447.723 676.981 444.649C691.236 441.576 707.485 450.084 711.815 464.009C714.198 437.162 716.943 409.191 731.217 386.329C744.141 365.628 766.525 350.815 790.785 348.165C815.045 345.515 840.588 355.524 855.718 374.672C870.848 393.82 874.553 421.658 863.956 443.641C856.15 459.836 841.768 471.888 826.699 481.693C778.008 513.11 719.608 525.886 662.246 517.67L666.092 514.257Z" fill="#F2F2F2"/>
    <path d="M831.728 356.079C811.71 372.383 793.346 390.619 776.902 410.521C751.166 441.562 730.34 476.364 715.15 513.715C714.038 516.44 718.462 517.626 719.562 514.932C744.416 454.228 784.092 400.724 834.963 359.314C837.248 357.454 833.993 354.234 831.728 356.079Z" fill="white"/>
    <path d="M280.067 511.699C295.366 498.772 304.658 478.351 302.221 458.471C299.784 438.591 284.69 420.315 265.112 416.094C245.533 411.872 223.214 423.558 217.267 442.684C213.995 405.81 210.223 367.392 190.619 335.991C172.868 307.558 142.122 287.213 108.801 283.573C75.4801 279.933 40.3972 293.68 19.6161 319.98C-1.1651 346.28 -6.25327 384.515 8.30131 414.709C19.0232 436.952 38.7766 453.506 59.4733 466.973C125.503 509.939 207.412 527.858 285.351 516.388" fill="#F2F2F2"/>
    <path d="M52.5668 294.442C80.0608 316.836 105.284 341.883 127.871 369.219C150.461 396.527 170.35 425.961 187.257 457.109C196.707 474.582 205.196 492.557 212.687 510.956C214.214 514.698 208.137 516.327 206.627 512.626C193.359 480.191 176.944 449.133 157.618 419.899C138.385 390.772 116.373 363.578 91.889 338.701C78.041 324.637 63.4302 311.346 48.1228 298.886C44.9852 296.331 49.4551 291.908 52.5668 294.442L52.5668 294.442Z" fill="white"/>
    <path d="M624.5 519H259.5V144.5C259.5 64.8223 324.322 0 404 0H480C559.678 0 624.5 64.8223 624.5 144.5V519Z" fill="#F2F2F2"/>
    <path d="M548.5 519H259.5V144.5C259.42 113.969 269.088 84.2103 287.096 59.5557C287.76 58.6509 288.422 57.7578 289.104 56.8745C297.815 45.4506 308.18 35.3897 319.859 27.0239C320.518 26.5439 321.181 26.0723 321.853 25.6006C331.625 18.838 342.196 13.3097 353.325 9.1416C353.986 8.89111 354.659 8.64013 355.332 8.3994C365.397 4.80747 375.83 2.34703 386.44 1.06348C387.098 0.973628 387.773 0.903319 388.448 0.833009C398.787 -0.272461 409.215 -0.272461 419.554 0.833009C420.227 0.903319 420.902 0.973619 421.568 1.06444C432.175 2.34807 442.606 4.80822 452.668 8.39945C453.341 8.64018 454.014 8.89114 454.677 9.14212C465.669 13.2577 476.115 18.7035 485.783 25.3579C486.455 25.8194 487.127 26.2911 487.79 26.7627C494.336 31.4355 500.485 36.6412 506.173 42.3267C510.735 46.8871 514.986 51.7483 518.898 56.8775C519.578 57.7579 520.24 58.6509 520.903 59.5543C538.911 84.2091 548.58 113.969 548.5 144.5V519Z" fill="#CCCCCC"/>
    <path d="M525 351.5C533.836 351.5 541 344.337 541 335.5C541 326.663 533.836 319.5 525 319.5C516.163 319.5 509 326.663 509 335.5C509 344.337 516.163 351.5 525 351.5Z" fill="#81FFC0"/>
    <path d="M594.599 507.783H582.339L576.506 460.495L594.601 460.496L594.599 507.783Z" fill="#FFB8B8"/>
    <path d="M573.582 504.28H597.225V519.167H558.695C558.695 517.212 559.08 515.276 559.828 513.47C560.576 511.664 561.673 510.022 563.055 508.64C564.437 507.258 566.079 506.161 567.885 505.413C569.691 504.665 571.627 504.28 573.582 504.28V504.28Z" fill="#2F2E41"/>
    <path d="M655.599 507.783H643.339L637.506 460.495L655.601 460.496L655.599 507.783Z" fill="#FFB8B8"/>
    <path d="M634.582 504.28H658.225V519.167H619.695C619.695 517.212 620.08 515.276 620.828 513.47C621.576 511.664 622.673 510.022 624.055 508.64C625.437 507.258 627.079 506.161 628.885 505.413C630.691 504.665 632.627 504.28 634.582 504.28V504.28Z" fill="#2F2E41"/>
    <path d="M533.098 338.67C532.216 337.37 531.629 335.893 531.38 334.343C531.131 332.792 531.224 331.206 531.654 329.695C532.084 328.185 532.84 326.787 533.869 325.6C534.898 324.413 536.174 323.467 537.608 322.827L579.284 207.96L599.791 219.151L552.206 328.922C553.122 331.403 553.096 334.133 552.133 336.595C551.17 339.058 549.337 341.082 546.982 342.283C544.626 343.485 541.912 343.781 539.353 343.115C536.794 342.449 534.568 340.867 533.098 338.67V338.67Z" fill="#FFB8B8"/>
    <path d="M649.336 360.254C647.974 359.472 646.799 358.402 645.895 357.118C644.991 355.834 644.38 354.367 644.104 352.821C643.828 351.275 643.895 349.687 644.299 348.169C644.703 346.652 645.435 345.241 646.443 344.037L633.533 222.528L656.87 223.594L662.236 343.114C664.147 344.942 665.32 347.408 665.535 350.043C665.749 352.678 664.989 355.301 663.399 357.414C661.809 359.526 659.499 360.982 656.907 361.506C654.316 362.029 651.622 361.584 649.336 360.254V360.254Z" fill="#FFB8B8"/>
    <path d="M612.106 186.684C625.67 186.684 636.667 175.687 636.667 162.123C636.667 148.558 625.67 137.562 612.106 137.562C598.541 137.562 587.545 148.558 587.545 162.123C587.545 175.687 598.541 186.684 612.106 186.684Z" fill="#FFB8B8"/>
    <path d="M649.18 332.619H575.133L575.222 332.043C575.355 331.181 588.419 245.604 578.784 217.607C577.817 214.855 577.902 211.844 579.022 209.151C580.143 206.459 582.22 204.276 584.853 203.023H584.853C598.625 196.538 625.061 188.552 647.373 207.932C650.657 210.831 653.22 214.454 654.862 218.515C656.504 222.575 657.179 226.962 656.833 231.328L649.18 332.619Z" fill="#81FFC0"/>
    <path d="M589.354 258.25L556.018 251.487L571.644 214.457C572.579 210.871 574.899 207.802 578.094 205.923C581.289 204.044 585.098 203.51 588.687 204.436C592.276 205.363 595.351 207.675 597.237 210.865C599.124 214.056 599.667 217.864 598.75 221.455L589.354 258.25Z" fill="#81FFC0"/>
    <path d="M632.05 270.808L630.046 224.867C628.526 216.23 633.47 208.066 641.074 206.732C648.679 205.402 656.105 211.392 657.632 220.092L665.165 263.019L632.05 270.808Z" fill="#81FFC0"/>
    <path d="M646.716 327.119C658.631 372.495 659.93 430.188 656.716 493.119L640.716 491.119L611.716 371.119L595.716 493.119L577.716 492.119C572.339 426.089 567.103 369.403 575.716 332.119L646.716 327.119Z" fill="#2F2E41"/>
    <path d="M628.289 181.104C623.707 185.985 615.198 183.365 614.601 176.697C614.554 176.179 614.557 175.658 614.611 175.141C614.919 172.188 616.625 169.506 616.217 166.388C616.124 165.611 615.835 164.872 615.377 164.239C611.725 159.349 603.154 166.425 599.708 161.999C597.595 159.285 600.079 155.012 598.458 151.979C596.318 147.975 589.979 149.95 586.004 147.758C581.581 145.318 581.846 138.532 584.757 134.405C588.308 129.371 594.533 126.685 600.68 126.298C606.828 125.911 612.933 127.573 618.673 129.81C625.194 132.351 631.66 135.863 635.673 141.597C640.554 148.57 641.023 157.945 638.583 166.099C637.098 171.059 632.031 177.118 628.289 181.104Z" fill="#2F2E41"/>
    <path d="M839.982 519.643H101.688C101.372 519.643 101.07 519.517 100.848 519.293C100.625 519.07 100.5 518.768 100.5 518.453C100.5 518.138 100.625 517.835 100.848 517.612C101.07 517.389 101.372 517.263 101.688 517.262H839.982C840.297 517.263 840.599 517.389 840.821 517.612C841.044 517.835 841.169 518.138 841.169 518.453C841.169 518.768 841.044 519.07 840.821 519.293C840.599 519.517 840.297 519.643 839.982 519.643V519.643Z" fill="#3F3D56"/>
    <path d="M469 410.5H339C337.288 410.509 335.642 409.839 334.424 408.636C333.205 407.434 332.513 405.797 332.5 404.085V113.915C332.513 112.203 333.205 110.566 334.424 109.364C335.642 108.161 337.288 107.491 339 107.5H469C470.712 107.491 472.358 108.161 473.576 109.364C474.795 110.566 475.487 112.203 475.5 113.915V404.085C475.487 405.797 474.795 407.434 473.576 408.636C472.358 409.839 470.712 410.509 469 410.5V410.5Z" fill="white"/>
    <path d="M475.5 201.39H332.5V203.39H475.5V201.39Z" fill="#CCCCCC"/>
    <path d="M476 315.5H333V317.5H476V315.5Z" fill="#CCCCCC"/>
    <path d="M379.5 107.5H377.5V411.5H379.5V107.5Z" fill="#CCCCCC"/>
    <path d="M429.5 107.5H427.5V411.5H429.5V107.5Z" fill="#CCCCCC"/>
    </g>
    <defs>
    <clipPath id="clip0_101_45">
    <rect width="870" height="520.139" fill="white"/>
    </clipPath>
    </defs>
  </svg>    

  <h2>Sign in and create tasks</h2>

    {:else}
    <svg class="noTask" viewBox="0 0 648 633" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g clip-path="url(#clip0_101_23)">
        <path
          d="M411.146 142.174H236.636C232.659 142.179 228.847 143.761 226.035 146.573C223.223 149.385 221.641 153.197 221.636 157.174V545.024L219.636 545.634L176.826 558.744C174.797 559.362 172.606 559.151 170.733 558.155C168.86 557.16 167.459 555.462 166.836 553.434L39.4961 137.484C38.8764 135.455 39.0876 133.263 40.0833 131.39C41.079 129.516 42.7778 128.115 44.8062 127.494L110.776 107.294L302.026 48.7538L367.996 28.5538C369 28.2448 370.055 28.1368 371.101 28.236C372.147 28.3353 373.162 28.6397 374.09 29.132C375.018 29.6243 375.84 30.2947 376.509 31.1049C377.177 31.9152 377.679 32.8493 377.986 33.8538L410.536 140.174L411.146 142.174Z"
          fill="#F2F2F2"
        />
        <path
          d="M449.226 140.174L409.996 12.0339C409.343 9.89882 408.276 7.9133 406.856 6.19077C405.436 4.46825 403.69 3.04249 401.718 1.99494C399.747 0.947401 397.588 0.298606 395.366 0.0856568C393.143 -0.127292 390.901 0.0997786 388.766 0.75387L296.016 29.1439L104.776 87.6939L12.0264 116.094C7.71776 117.417 4.11004 120.395 1.99518 124.376C-0.119678 128.356 -0.568904 133.013 0.746128 137.324L134.826 575.254C135.894 578.734 138.05 581.78 140.976 583.945C143.903 586.11 147.446 587.28 151.086 587.284C152.771 587.285 154.447 587.032 156.056 586.534L219.636 567.074L221.636 566.454V564.364L219.636 564.974L155.466 584.624C151.663 585.783 147.555 585.387 144.044 583.521C140.533 581.656 137.905 578.474 136.736 574.674L2.66654 136.734C2.08763 134.851 1.88586 132.872 2.07279 130.911C2.25971 128.95 2.83164 127.045 3.75586 125.305C4.68008 123.565 5.93844 122.025 7.45884 120.772C8.97923 119.519 10.7318 118.578 12.6162 118.004L105.366 89.6039L296.606 31.0639L389.356 2.66389C390.786 2.22769 392.272 2.00528 393.766 2.00388C396.973 2.01109 400.094 3.04504 402.671 4.95431C405.248 6.86358 407.146 9.54782 408.086 12.6139L447.136 140.174L447.756 142.174H449.836L449.226 140.174Z"
          fill="#3F3D56"
        />
        <path
          d="M122.681 127.821C120.754 127.819 118.877 127.2 117.328 126.055C115.778 124.909 114.636 123.296 114.07 121.454L101.189 79.3824C100.843 78.2523 100.723 77.065 100.836 75.8885C100.949 74.7119 101.292 73.5691 101.847 72.5254C102.401 71.4816 103.156 70.5572 104.067 69.8052C104.979 69.0531 106.03 68.488 107.16 68.1421L283.099 14.2784C285.382 13.5819 287.847 13.8194 289.955 14.9388C292.062 16.0582 293.639 17.968 294.34 20.2491L307.221 62.3213C307.917 64.6037 307.679 67.069 306.559 69.1763C305.44 71.2836 303.531 72.8609 301.25 73.5621L125.31 127.426C124.458 127.687 123.572 127.82 122.681 127.821V127.821Z"
          fill="#81FFC0"
        />
        <path
          d="M190.154 44.9546C201.199 44.9546 210.154 36.0003 210.154 24.9546C210.154 13.9089 201.199 4.95459 190.154 4.95459C179.108 4.95459 170.154 13.9089 170.154 24.9546C170.154 36.0003 179.108 44.9546 190.154 44.9546Z"
          fill="#81FFC0"
        />
        <path
          d="M190.154 37.6193C197.148 37.6193 202.818 31.9491 202.818 24.9547C202.818 17.9602 197.148 12.29 190.154 12.29C183.159 12.29 177.489 17.9602 177.489 24.9547C177.489 31.9491 183.159 37.6193 190.154 37.6193Z"
          fill="white"
        />
        <path
          d="M602.636 582.174H264.636C262.383 582.171 260.222 581.275 258.629 579.681C257.035 578.088 256.139 575.927 256.136 573.674V168.674C256.139 166.42 257.035 164.26 258.629 162.666C260.222 161.073 262.383 160.176 264.636 160.174H602.636C604.89 160.176 607.05 161.073 608.644 162.666C610.237 164.26 611.134 166.42 611.136 168.674V573.674C611.134 575.927 610.237 578.088 608.644 579.681C607.05 581.275 604.89 582.171 602.636 582.174V582.174Z"
          fill="#E6E6E6"
        />
        <path
          d="M447.136 140.174H236.636C232.13 140.18 227.809 141.973 224.622 145.16C221.436 148.347 219.643 152.667 219.636 157.174V564.974L221.636 564.364V157.174C221.641 153.197 223.223 149.385 226.035 146.573C228.847 143.761 232.659 142.179 236.636 142.174H447.756L447.136 140.174ZM630.636 140.174H236.636C232.13 140.18 227.809 141.973 224.622 145.16C221.436 148.347 219.643 152.667 219.636 157.174V615.174C219.643 619.681 221.436 624.001 224.622 627.188C227.809 630.374 232.13 632.167 236.636 632.174H630.636C635.143 632.167 639.463 630.374 642.65 627.188C645.837 624.001 647.63 619.681 647.636 615.174V157.174C647.63 152.667 645.837 148.347 642.65 145.16C639.463 141.973 635.143 140.18 630.636 140.174V140.174ZM645.636 615.174C645.631 619.151 644.049 622.963 641.237 625.775C638.425 628.587 634.613 630.169 630.636 630.174H236.636C232.659 630.169 228.847 628.587 226.035 625.775C223.223 622.963 221.641 619.151 221.636 615.174V157.174C221.641 153.197 223.223 149.385 226.035 146.573C228.847 143.761 232.659 142.179 236.636 142.174H630.636C634.613 142.179 638.425 143.761 641.237 146.573C644.049 149.385 645.631 153.197 645.636 157.174V615.174Z"
          fill="#3F3D56"
        />
        <path
          d="M525.636 184.174H341.636C339.25 184.171 336.963 183.222 335.275 181.535C333.588 179.848 332.639 177.56 332.636 175.174V131.174C332.639 128.788 333.588 126.5 335.276 124.813C336.963 123.126 339.25 122.177 341.636 122.174H525.636C528.023 122.177 530.31 123.126 531.997 124.813C533.685 126.5 534.634 128.788 534.636 131.174V175.174C534.634 177.56 533.685 179.848 531.997 181.535C530.31 183.222 528.023 184.171 525.636 184.174V184.174Z"
          fill="#81FFC0"
        />
        <path
          d="M433.636 125.174C444.682 125.174 453.636 116.22 453.636 105.174C453.636 94.1281 444.682 85.1738 433.636 85.1738C422.591 85.1738 413.636 94.1281 413.636 105.174C413.636 116.22 422.591 125.174 433.636 125.174Z"
          fill="#81FFC0"
        />
        <path
          d="M433.636 117.356C440.364 117.356 445.818 111.902 445.818 105.174C445.818 98.446 440.364 92.9919 433.636 92.9919C426.908 92.9919 421.454 98.446 421.454 105.174C421.454 111.902 426.908 117.356 433.636 117.356Z"
          fill="white"
        />
      </g>
      <defs>
        <clipPath id="clip0_101_23">
          <rect width="647.636" height="632.174" fill="white" />
        </clipPath>
      </defs>
    </svg>
    <h2>There are no tasks. Create task</h2>
    {/if}
  {/each}
</main>
<Link to="create" title="Create">
  <a href="create" class="float">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 448 512"
      fill="#004221"
      class="my-float"
    >
      <path
        d="M432 256c0 17.69-14.33 32.01-32 32.01H256v144c0 17.69-14.33 31.99-32 31.99s-32-14.3-32-31.99v-144H48c-17.67 0-32-14.32-32-32.01s14.33-31.99 32-31.99H192v-144c0-17.69 14.33-32.01 32-32.01s32 14.32 32 32.01v144h144C417.7 224 432 238.3 432 256z"
      />
    </svg>
  </a>
</Link>

<style>
  .task {
    background-color: #fff;
    margin: 20px 0px;
    padding: 0 10px;
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .noTask, .logIn {
    display: block;
    margin: auto;
    width: 20rem;
    height: auto;
  }

  .left-sec {
    display: flex;
    align-items: center;
    margin: 0;
  }
  .below-sec {
    margin: 0 10px;
  }
  input {
    margin: 0 10px;
  }
  .float {
    display: flex;
    justify-content: center;
    position: fixed;
    width: 60px;
    height: 60px;
    bottom: 60px;
    right: 60px;
    background-color: #81ffc0;
    border-radius: 50px;
    text-align: center;
  }
  .my-float {
    width: 50%;
    height: auto;
  }
</style>
